# cleanup-logs â€” Trim old audit log entries
#
# Runs every Sunday at 4 AM. Keeps only the last 10,000 lines of each
# audit log file to prevent unbounded disk growth.
#
# To use: copy this file to ~/.config/openpalm/automations/cleanup-logs
# then restart admin:  docker compose restart admin

SHELL=/bin/bash

0 4 * * 0 node bash -c '. /etc/openpalm-env && for f in "$OPENPALM_STATE_HOME"/audit/*.jsonl "$OPENPALM_STATE_HOME"/audit/*.log; do [ -f "$f" ] || continue; tail -n 10000 "$f" > "$f.tmp" && mv "$f.tmp" "$f"; done'
