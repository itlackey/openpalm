# cleanup-logs.yml â€” Trim old audit log entries
#
# Runs every Sunday at 4 AM. Keeps only the last 10,000 lines of each
# audit log file to prevent unbounded disk growth.
#
# To use: copy this file to ~/.config/openpalm/automations/cleanup-logs.yml

name: Cleanup Logs
description: Trim old audit log entries to prevent unbounded disk growth
schedule: weekly-sunday-4am
enabled: true

action:
  type: shell
  command:
    - /bin/bash
    - -c
    - |
      for f in "$OPENPALM_STATE_HOME"/audit/*.jsonl "$OPENPALM_STATE_HOME"/audit/*.log; do
        [ -f "$f" ] || continue
        tail -n 10000 "$f" > "$f.tmp" && mv "$f.tmp" "$f"
      done
  timeout: 30000

on_failure: log
