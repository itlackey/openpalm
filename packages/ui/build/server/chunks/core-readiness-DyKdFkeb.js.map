{"version":3,"file":"core-readiness-DyKdFkeb.js","sources":["../../../.svelte-kit/adapter-node/chunks/core-readiness.js"],"sourcesContent":["import { createComposeRunner, CoreServices } from \"./compose-runner.js\";\nconst DefaultProbeTimeoutMs = 3e3;\nasync function ensureCoreServicesReady(options = {}) {\n  const runner = options.runner ?? createComposeRunner();\n  const targetServices = options.targetServices ?? CoreServices;\n  const maxAttempts = normalizeMaxAttempts(options.maxAttempts);\n  const pollIntervalMs = normalizePollIntervalMs(options.pollIntervalMs);\n  const sleep = options.sleep ?? defaultSleep;\n  const fetchImpl = options.fetchImpl ?? fetch;\n  const probeTimeoutMs = normalizeProbeTimeoutMs(options.probeTimeoutMs);\n  let lastChecks = [];\n  let lastComposePsStderr = \"\";\n  for (let attempt = 0; attempt < maxAttempts; attempt += 1) {\n    const psResult = await runner.ps();\n    if (psResult.stderr) {\n      lastComposePsStderr = psResult.stderr;\n    }\n    if (!psResult.ok) {\n      const failedServices3 = targetServices.map((service) => ({\n        service,\n        state: \"not_ready\",\n        status: \"unknown\",\n        health: null\n      }));\n      return {\n        ok: false,\n        code: \"compose_ps_failed\",\n        checks: failedServices3,\n        diagnostics: {\n          composePsStderr: psResult.stderr,\n          failedServices: failedServices3\n        }\n      };\n    }\n    const checks = buildReadinessChecks(psResult.services, targetServices);\n    const composeFailedServices = checks.filter((service) => service.state === \"not_ready\");\n    if (composeFailedServices.length > 0) {\n      lastChecks = checks;\n      if (attempt < maxAttempts - 1) {\n        await sleep(pollIntervalMs);\n      }\n      continue;\n    }\n    const probeFailures = await runHttpReadinessProbes(\n      targetServices,\n      fetchImpl,\n      probeTimeoutMs\n    );\n    const checksWithProbes = applyProbeFailuresToChecks(checks, probeFailures);\n    const failedServices2 = checksWithProbes.filter((service) => service.state === \"not_ready\");\n    if (failedServices2.length === 0) {\n      return {\n        ok: true,\n        code: \"ready\",\n        checks: checksWithProbes,\n        diagnostics: {\n          failedServices: []\n        }\n      };\n    }\n    lastChecks = checksWithProbes;\n    if (attempt < maxAttempts - 1) {\n      await sleep(pollIntervalMs);\n    }\n  }\n  const failedServices = lastChecks.filter((service) => service.state === \"not_ready\");\n  const failedServiceLogs = await collectFailedServiceLogs(runner, failedServices);\n  return {\n    ok: false,\n    code: \"setup_not_ready\",\n    checks: lastChecks,\n    diagnostics: {\n      composePsStderr: lastComposePsStderr,\n      failedServices,\n      failedServiceLogs\n    }\n  };\n}\nfunction normalizeMaxAttempts(value) {\n  if (!Number.isFinite(value)) return 12;\n  return Math.max(1, Math.floor(value));\n}\nfunction normalizePollIntervalMs(value) {\n  if (!Number.isFinite(value)) return 1e3;\n  return Math.max(0, Math.floor(value));\n}\nfunction normalizeProbeTimeoutMs(value) {\n  if (!Number.isFinite(value)) return DefaultProbeTimeoutMs;\n  return Math.max(1, Math.floor(value));\n}\nfunction defaultSleep(ms) {\n  return new Promise((resolve) => {\n    setTimeout(resolve, ms);\n  });\n}\nasync function collectFailedServiceLogs(runner, failedServices) {\n  const names = Array.from(\n    new Set(\n      failedServices.map((service) => service.service).filter((service) => service.length > 0)\n    )\n  );\n  const entries = await Promise.all(\n    names.map(async (service) => {\n      const result = await runner.logs(service, 200);\n      if (result.ok) {\n        return [service, result.stdout];\n      }\n      const detail = result.stderr || \"log_collection_failed\";\n      return [service, `log_fetch_failed:${detail}`];\n    })\n  );\n  return Object.fromEntries(entries);\n}\nfunction buildReadinessChecks(services, targetServices) {\n  const byName = new Map(\n    services.map((service) => [service.name, service])\n  );\n  return targetServices.map((serviceName) => {\n    const service = byName.get(serviceName);\n    if (!service) {\n      return {\n        service: serviceName,\n        state: \"not_ready\",\n        status: \"missing\",\n        health: null,\n        reason: \"missing\"\n      };\n    }\n    const isRunning = service.status.toLowerCase().includes(\"running\");\n    if (!isRunning) {\n      return {\n        service: serviceName,\n        state: \"not_ready\",\n        status: service.status,\n        health: service.health ?? null,\n        reason: \"not_running\"\n      };\n    }\n    const hasHealthcheck = typeof service.health === \"string\" && service.health.length > 0;\n    if (hasHealthcheck && service.health !== \"healthy\") {\n      return {\n        service: serviceName,\n        state: \"not_ready\",\n        status: service.status,\n        health: service.health,\n        reason: \"unhealthy\"\n      };\n    }\n    return {\n      service: serviceName,\n      state: \"ready\",\n      status: service.status,\n      health: service.health ?? null\n    };\n  });\n}\nfunction probeConfigForService(service) {\n  if (service === \"admin\") {\n    return {\n      url: `${trimTrailingSlash(envValue(\"OPENPALM_ADMIN_API_URL\") ?? \"http://admin:8100\")}/health`,\n      expectJson: true\n    };\n  }\n  if (service === \"gateway\") {\n    return {\n      url: `${trimTrailingSlash(envValue(\"GATEWAY_URL\") ?? \"http://gateway:8080\")}/health`,\n      expectJson: true\n    };\n  }\n  if (service === \"assistant\") {\n    return {\n      url: `${trimTrailingSlash(envValue(\"OPENPALM_ASSISTANT_URL\") ?? \"http://assistant:4096\")}/`,\n      expectJson: false\n    };\n  }\n  if (service === \"openmemory\") {\n    return {\n      url: `${trimTrailingSlash(envValue(\"OPENMEMORY_URL\") ?? \"http://openmemory:8765\")}/api/v1/config/`,\n      expectJson: true\n    };\n  }\n  return null;\n}\nasync function runHttpReadinessProbes(targetServices, fetchImpl, timeoutMs) {\n  const probeTargets = targetServices.map((service) => ({ service, config: probeConfigForService(service) })).filter((entry) => entry.config !== null);\n  const probeResults = await Promise.all(\n    probeTargets.map(async ({ service, config }) => {\n      const probe = await runHttpProbe(config, fetchImpl, timeoutMs);\n      if (probe.ok) return null;\n      return {\n        service,\n        url: config.url,\n        error: probe.error\n      };\n    })\n  );\n  return probeResults.filter((result) => result !== null);\n}\nasync function runHttpProbe(config, fetchImpl, timeoutMs) {\n  try {\n    const response = await fetchImpl(config.url, {\n      signal: AbortSignal.timeout(timeoutMs)\n    });\n    if (!response.ok) {\n      return { ok: false, error: `status ${response.status}` };\n    }\n    if (!config.expectJson) {\n      return { ok: true };\n    }\n    const body = await response.json();\n    if (body.ok === false) {\n      return { ok: false, error: \"body.ok false\" };\n    }\n    return { ok: true };\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    return { ok: false, error: message };\n  }\n}\nfunction applyProbeFailuresToChecks(checks, probeFailures) {\n  if (probeFailures.length === 0) {\n    return checks;\n  }\n  const failuresByService = new Map(\n    probeFailures.map((failure) => [failure.service, failure])\n  );\n  return checks.map((check) => {\n    const failure = failuresByService.get(check.service);\n    if (!failure) {\n      return check;\n    }\n    return {\n      ...check,\n      state: \"not_ready\",\n      reason: \"http_probe_failed\",\n      probeUrl: failure.url,\n      probeError: failure.error\n    };\n  });\n}\nfunction envValue(name) {\n  const bunEnv = globalThis.Bun?.env;\n  return bunEnv?.[name] ?? process.env[name];\n}\nfunction trimTrailingSlash(value) {\n  return value.endsWith(\"/\") ? value.slice(0, -1) : value;\n}\nexport {\n  ensureCoreServicesReady\n};\n"],"names":[],"mappings":"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"}