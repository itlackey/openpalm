{"version":3,"file":"_server.ts-DT8NCrgT.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/opencode/_...path_/_server.ts.js"],"sourcesContent":["import { u as unauthorizedJson, j as json } from \"../../../../chunks/json.js\";\nimport { O as OPENPALM_ASSISTANT_URL } from \"../../../../chunks/config.js\";\nconst SAFE_FORWARD_HEADERS = [\"content-type\", \"accept\", \"content-length\"];\nfunction buildSafeHeaders(original) {\n  const safe = new Headers();\n  for (const name of SAFE_FORWARD_HEADERS) {\n    const value = original.get(name);\n    if (value) safe.set(name, value);\n  }\n  return safe;\n}\nconst handler = async ({ params, url, request, locals }) => {\n  if (!locals.authenticated) return unauthorizedJson();\n  const subpath = params.path ? `/${params.path}` : \"/\";\n  const target = `${OPENPALM_ASSISTANT_URL}${subpath}${url.search}`;\n  try {\n    const proxyResp = await fetch(target, {\n      method: request.method,\n      headers: buildSafeHeaders(request.headers),\n      body: request.method !== \"GET\" && request.method !== \"HEAD\" ? request.body : void 0,\n      signal: AbortSignal.timeout(3e5),\n      // 5 minutes for AI responses\n      // @ts-expect-error duplex needed for streaming body\n      duplex: \"half\"\n    });\n    return new Response(proxyResp.body, {\n      status: proxyResp.status,\n      headers: proxyResp.headers\n    });\n  } catch {\n    return json(502, { error: \"assistant_unavailable\" });\n  }\n};\nconst GET = handler;\nconst POST = handler;\nconst PUT = handler;\nconst DELETE = handler;\nconst PATCH = handler;\nexport {\n  DELETE,\n  GET,\n  PATCH,\n  POST,\n  PUT\n};\n"],"names":[],"mappings":";;;;;AAEA,MAAM,oBAAoB,GAAG,CAAC,cAAc,EAAE,QAAQ,EAAE,gBAAgB,CAAC;AACzE,SAAS,gBAAgB,CAAC,QAAQ,EAAE;AACpC,EAAE,MAAM,IAAI,GAAG,IAAI,OAAO,EAAE;AAC5B,EAAE,KAAK,MAAM,IAAI,IAAI,oBAAoB,EAAE;AAC3C,IAAI,MAAM,KAAK,GAAG,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC;AACpC,IAAI,IAAI,KAAK,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC;AACpC,EAAE;AACF,EAAE,OAAO,IAAI;AACb;AACA,MAAM,OAAO,GAAG,OAAO,EAAE,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,MAAM,EAAE,KAAK;AAC5D,EAAE,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,OAAO,gBAAgB,EAAE;AACtD,EAAE,MAAM,OAAO,GAAG,MAAM,CAAC,IAAI,GAAG,CAAC,CAAC,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC,GAAG,GAAG;AACvD,EAAE,MAAM,MAAM,GAAG,CAAC,EAAE,sBAAsB,CAAC,EAAE,OAAO,CAAC,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC;AACnE,EAAE,IAAI;AACN,IAAI,MAAM,SAAS,GAAG,MAAM,KAAK,CAAC,MAAM,EAAE;AAC1C,MAAM,MAAM,EAAE,OAAO,CAAC,MAAM;AAC5B,MAAM,OAAO,EAAE,gBAAgB,CAAC,OAAO,CAAC,OAAO,CAAC;AAChD,MAAM,IAAI,EAAE,OAAO,CAAC,MAAM,KAAK,KAAK,IAAI,OAAO,CAAC,MAAM,KAAK,MAAM,GAAG,OAAO,CAAC,IAAI,GAAG,KAAK,CAAC;AACzF,MAAM,MAAM,EAAE,WAAW,CAAC,OAAO,CAAC,GAAG,CAAC;AACtC;AACA;AACA,MAAM,MAAM,EAAE;AACd,KAAK,CAAC;AACN,IAAI,OAAO,IAAI,QAAQ,CAAC,SAAS,CAAC,IAAI,EAAE;AACxC,MAAM,MAAM,EAAE,SAAS,CAAC,MAAM;AAC9B,MAAM,OAAO,EAAE,SAAS,CAAC;AACzB,KAAK,CAAC;AACN,EAAE,CAAC,CAAC,MAAM;AACV,IAAI,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,KAAK,EAAE,uBAAuB,EAAE,CAAC;AACxD,EAAE;AACF,CAAC;AACI,MAAC,GAAG,GAAG;AACP,MAAC,IAAI,GAAG;AACR,MAAC,GAAG,GAAG;AACP,MAAC,MAAM,GAAG;AACV,MAAC,KAAK,GAAG;;;;"}