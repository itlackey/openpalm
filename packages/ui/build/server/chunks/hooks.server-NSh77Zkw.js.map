{"version":3,"file":"hooks.server-NSh77Zkw.js","sources":["../../../.svelte-kit/adapter-node/entries/hooks.server.js"],"sourcesContent":["import { v as verifyAdminToken } from \"../chunks/auth.js\";\nimport { e as ensureInitialized, a as getSetupManager } from \"../chunks/init.js\";\nfunction isPrivateOrigin(origin) {\n  try {\n    const { hostname } = new URL(origin);\n    return hostname === \"localhost\" || hostname === \"127.0.0.1\" || hostname.startsWith(\"10.\") || hostname.startsWith(\"192.168.\") || /^172\\.(1[6-9]|2\\d|3[01])\\./.test(hostname) || hostname === \"::1\" || hostname === \"[::1]\";\n  } catch {\n    return false;\n  }\n}\nfunction computeAllowedOrigin(scope, requestOrigin) {\n  if (!requestOrigin) return \"\";\n  if (scope === \"public\") return requestOrigin;\n  if (scope === \"lan\") {\n    if (isPrivateOrigin(requestOrigin)) return requestOrigin;\n    return \"http://localhost\";\n  }\n  if (requestOrigin.includes(\"localhost\") || requestOrigin.includes(\"127.0.0.1\")) {\n    return requestOrigin;\n  }\n  return \"http://localhost\";\n}\nconst handle = async ({ event, resolve: resolveEvent }) => {\n  await ensureInitialized();\n  const setupManager = await getSetupManager();\n  const { accessScope } = setupManager.getState();\n  const requestOrigin = event.request.headers.get(\"origin\") ?? \"\";\n  const allowedOrigin = computeAllowedOrigin(accessScope ?? \"host\", requestOrigin);\n  if (event.request.method === \"OPTIONS\") {\n    return new Response(null, {\n      status: 204,\n      headers: {\n        ...allowedOrigin ? { \"access-control-allow-origin\": allowedOrigin } : {},\n        \"access-control-allow-headers\": \"content-type, x-admin-token, x-request-id\",\n        \"access-control-allow-methods\": \"GET, POST, OPTIONS\",\n        vary: \"Origin\"\n      }\n    });\n  }\n  const token = event.request.headers.get(\"x-admin-token\") ?? \"\";\n  event.locals.authenticated = verifyAdminToken(token);\n  const response = await resolveEvent(event);\n  if (allowedOrigin) {\n    response.headers.set(\"access-control-allow-origin\", allowedOrigin);\n  }\n  response.headers.set(\n    \"access-control-allow-headers\",\n    \"content-type, x-admin-token, x-request-id\"\n  );\n  response.headers.set(\"access-control-allow-methods\", \"GET, POST, OPTIONS\");\n  response.headers.append(\"vary\", \"Origin\");\n  return response;\n};\nexport {\n  handle\n};\n"],"names":[],"mappings":";;;;;;;;;;;AAEA,SAAS,eAAe,CAAC,MAAM,EAAE;AACjC,EAAE,IAAI;AACN,IAAI,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAI,GAAG,CAAC,MAAM,CAAC;AACxC,IAAI,OAAO,QAAQ,KAAK,WAAW,IAAI,QAAQ,KAAK,WAAW,IAAI,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,QAAQ,CAAC,UAAU,CAAC,UAAU,CAAC,IAAI,4BAA4B,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,QAAQ,KAAK,KAAK,IAAI,QAAQ,KAAK,OAAO;AAC7N,EAAE,CAAC,CAAC,MAAM;AACV,IAAI,OAAO,KAAK;AAChB,EAAE;AACF;AACA,SAAS,oBAAoB,CAAC,KAAK,EAAE,aAAa,EAAE;AACpD,EAAE,IAAI,CAAC,aAAa,EAAE,OAAO,EAAE;AAC/B,EAAE,IAAI,KAAK,KAAK,QAAQ,EAAE,OAAO,aAAa;AAC9C,EAAE,IAAI,KAAK,KAAK,KAAK,EAAE;AACvB,IAAI,IAAI,eAAe,CAAC,aAAa,CAAC,EAAE,OAAO,aAAa;AAC5D,IAAI,OAAO,kBAAkB;AAC7B,EAAE;AACF,EAAE,IAAI,aAAa,CAAC,QAAQ,CAAC,WAAW,CAAC,IAAI,aAAa,CAAC,QAAQ,CAAC,WAAW,CAAC,EAAE;AAClF,IAAI,OAAO,aAAa;AACxB,EAAE;AACF,EAAE,OAAO,kBAAkB;AAC3B;AACK,MAAC,MAAM,GAAG,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,YAAY,EAAE,KAAK;AAC3D,EAAE,MAAM,iBAAiB,EAAE;AAC3B,EAAE,MAAM,YAAY,GAAG,MAAM,eAAe,EAAE;AAC9C,EAAE,MAAM,EAAE,WAAW,EAAE,GAAG,YAAY,CAAC,QAAQ,EAAE;AACjD,EAAE,MAAM,aAAa,GAAG,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,EAAE;AACjE,EAAE,MAAM,aAAa,GAAG,oBAAoB,CAAC,WAAW,IAAI,MAAM,EAAE,aAAa,CAAC;AAClF,EAAE,IAAI,KAAK,CAAC,OAAO,CAAC,MAAM,KAAK,SAAS,EAAE;AAC1C,IAAI,OAAO,IAAI,QAAQ,CAAC,IAAI,EAAE;AAC9B,MAAM,MAAM,EAAE,GAAG;AACjB,MAAM,OAAO,EAAE;AACf,QAAQ,GAAG,aAAa,GAAG,EAAE,6BAA6B,EAAE,aAAa,EAAE,GAAG,EAAE;AAChF,QAAQ,8BAA8B,EAAE,2CAA2C;AACnF,QAAQ,8BAA8B,EAAE,oBAAoB;AAC5D,QAAQ,IAAI,EAAE;AACd;AACA,KAAK,CAAC;AACN,EAAE;AACF,EAAE,MAAM,KAAK,GAAG,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,eAAe,CAAC,IAAI,EAAE;AAChE,EAAE,KAAK,CAAC,MAAM,CAAC,aAAa,GAAG,gBAAgB,CAAC,KAAK,CAAC;AACtD,EAAE,MAAM,QAAQ,GAAG,MAAM,YAAY,CAAC,KAAK,CAAC;AAC5C,EAAE,IAAI,aAAa,EAAE;AACrB,IAAI,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,6BAA6B,EAAE,aAAa,CAAC;AACtE,EAAE;AACF,EAAE,QAAQ,CAAC,OAAO,CAAC,GAAG;AACtB,IAAI,8BAA8B;AAClC,IAAI;AACJ,GAAG;AACH,EAAE,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,8BAA8B,EAAE,oBAAoB,CAAC;AAC5E,EAAE,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,MAAM,EAAE,QAAQ,CAAC;AAC3C,EAAE,OAAO,QAAQ;AACjB;;;;"}