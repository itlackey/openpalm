{"version":3,"file":"_server.ts-B6wRnfXV.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/setup/service-instances/_server.ts.js"],"sourcesContent":["import { u as unauthorizedJson, j as json } from \"../../../../chunks/json.js\";\nimport { a as getSetupManager } from \"../../../../chunks/init.js\";\nimport { s as sanitizeEnvScalar } from \"../../../../chunks/runtime-env.js\";\nimport { a as updateRuntimeEnv, b as updateSecretsEnv, c as readSecretsEnv } from \"../../../../chunks/env-helpers.js\";\nimport { i as isLocalRequest } from \"../../../../chunks/auth.js\";\nimport { a as applySmallModelToOpencodeConfig } from \"../../../../chunks/opencode-config.js\";\nconst POST = async ({ locals, request }) => {\n  const setupManager = await getSetupManager();\n  const body = await request.json();\n  const current = setupManager.getState();\n  if (current.completed && !locals.authenticated) return unauthorizedJson();\n  if (!current.completed && !isLocalRequest(request)) {\n    return json(403, { error: \"setup endpoints are restricted to local network access\" });\n  }\n  const openmemory = sanitizeEnvScalar(body.openmemory);\n  const psql = sanitizeEnvScalar(body.psql);\n  const qdrant = sanitizeEnvScalar(body.qdrant);\n  const openaiBaseUrl = sanitizeEnvScalar(body.openaiBaseUrl);\n  const openaiApiKey = sanitizeEnvScalar(body.openaiApiKey);\n  const anthropicApiKey = sanitizeEnvScalar(body.anthropicApiKey);\n  const smallModelEndpoint = sanitizeEnvScalar(body.smallModelEndpoint);\n  const smallModelApiKey = sanitizeEnvScalar(body.smallModelApiKey);\n  const smallModelId = sanitizeEnvScalar(body.smallModelId);\n  await updateRuntimeEnv({\n    OPENMEMORY_URL: openmemory || void 0,\n    OPENMEMORY_POSTGRES_URL: psql || void 0,\n    OPENMEMORY_QDRANT_URL: qdrant || void 0\n  });\n  const secretEntries = {\n    OPENAI_BASE_URL: openaiBaseUrl || void 0\n  };\n  if (openaiApiKey.length > 0) secretEntries.OPENAI_API_KEY = openaiApiKey;\n  if (anthropicApiKey.length > 0) secretEntries.ANTHROPIC_API_KEY = anthropicApiKey;\n  if (smallModelApiKey.length > 0) secretEntries.OPENPALM_SMALL_MODEL_API_KEY = smallModelApiKey;\n  await updateSecretsEnv(secretEntries);\n  const state = setupManager.setServiceInstances({ openmemory, psql, qdrant });\n  if (smallModelId) {\n    setupManager.setSmallModel({ endpoint: smallModelEndpoint, modelId: smallModelId });\n    applySmallModelToOpencodeConfig(smallModelEndpoint, smallModelId);\n  }\n  const secrets = readSecretsEnv();\n  return json(200, {\n    ok: true,\n    state,\n    openmemoryProvider: {\n      openaiBaseUrl: secrets.OPENAI_BASE_URL ?? \"\",\n      openaiApiKeyConfigured: Boolean(secrets.OPENAI_API_KEY)\n    },\n    smallModelProvider: {\n      endpoint: state.smallModel.endpoint,\n      modelId: state.smallModel.modelId,\n      apiKeyConfigured: Boolean(secrets.OPENPALM_SMALL_MODEL_API_KEY)\n    }\n  });\n};\nexport {\n  POST\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAMK,MAAC,IAAI,GAAG,OAAO,EAAE,MAAM,EAAE,OAAO,EAAE,KAAK;AAC5C,EAAE,MAAM,YAAY,GAAG,MAAM,eAAe,EAAE;AAC9C,EAAE,MAAM,IAAI,GAAG,MAAM,OAAO,CAAC,IAAI,EAAE;AACnC,EAAE,MAAM,OAAO,GAAG,YAAY,CAAC,QAAQ,EAAE;AACzC,EAAE,IAAI,OAAO,CAAC,SAAS,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,OAAO,gBAAgB,EAAE;AAC3E,EAAE,IAAI,CAAC,OAAO,CAAC,SAAS,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,EAAE;AACtD,IAAI,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,KAAK,EAAE,wDAAwD,EAAE,CAAC;AACzF,EAAE;AACF,EAAE,MAAM,UAAU,GAAG,iBAAiB,CAAC,IAAI,CAAC,UAAU,CAAC;AACvD,EAAE,MAAM,IAAI,GAAG,iBAAiB,CAAC,IAAI,CAAC,IAAI,CAAC;AAC3C,EAAE,MAAM,MAAM,GAAG,iBAAiB,CAAC,IAAI,CAAC,MAAM,CAAC;AAC/C,EAAE,MAAM,aAAa,GAAG,iBAAiB,CAAC,IAAI,CAAC,aAAa,CAAC;AAC7D,EAAE,MAAM,YAAY,GAAG,iBAAiB,CAAC,IAAI,CAAC,YAAY,CAAC;AAC3D,EAAE,MAAM,eAAe,GAAG,iBAAiB,CAAC,IAAI,CAAC,eAAe,CAAC;AACjE,EAAE,MAAM,kBAAkB,GAAG,iBAAiB,CAAC,IAAI,CAAC,kBAAkB,CAAC;AACvE,EAAE,MAAM,gBAAgB,GAAG,iBAAiB,CAAC,IAAI,CAAC,gBAAgB,CAAC;AACnE,EAAE,MAAM,YAAY,GAAG,iBAAiB,CAAC,IAAI,CAAC,YAAY,CAAC;AAC3D,EAAE,MAAM,gBAAgB,CAAC;AACzB,IAAI,cAAc,EAAE,UAAU,IAAI,MAAM;AACxC,IAAI,uBAAuB,EAAE,IAAI,IAAI,MAAM;AAC3C,IAAI,qBAAqB,EAAE,MAAM,IAAI;AACrC,GAAG,CAAC;AACJ,EAAE,MAAM,aAAa,GAAG;AACxB,IAAI,eAAe,EAAE,aAAa,IAAI;AACtC,GAAG;AACH,EAAE,IAAI,YAAY,CAAC,MAAM,GAAG,CAAC,EAAE,aAAa,CAAC,cAAc,GAAG,YAAY;AAC1E,EAAE,IAAI,eAAe,CAAC,MAAM,GAAG,CAAC,EAAE,aAAa,CAAC,iBAAiB,GAAG,eAAe;AACnF,EAAE,IAAI,gBAAgB,CAAC,MAAM,GAAG,CAAC,EAAE,aAAa,CAAC,4BAA4B,GAAG,gBAAgB;AAChG,EAAE,MAAM,gBAAgB,CAAC,aAAa,CAAC;AACvC,EAAE,MAAM,KAAK,GAAG,YAAY,CAAC,mBAAmB,CAAC,EAAE,UAAU,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;AAC9E,EAAE,IAAI,YAAY,EAAE;AACpB,IAAI,YAAY,CAAC,aAAa,CAAC,EAAE,QAAQ,EAAE,kBAAkB,EAAE,OAAO,EAAE,YAAY,EAAE,CAAC;AACvF,IAAI,+BAA+B,CAAC,kBAAkB,EAAE,YAAY,CAAC;AACrE,EAAE;AACF,EAAE,MAAM,OAAO,GAAG,cAAc,EAAE;AAClC,EAAE,OAAO,IAAI,CAAC,GAAG,EAAE;AACnB,IAAI,EAAE,EAAE,IAAI;AACZ,IAAI,KAAK;AACT,IAAI,kBAAkB,EAAE;AACxB,MAAM,aAAa,EAAE,OAAO,CAAC,eAAe,IAAI,EAAE;AAClD,MAAM,sBAAsB,EAAE,OAAO,CAAC,OAAO,CAAC,cAAc;AAC5D,KAAK;AACL,IAAI,kBAAkB,EAAE;AACxB,MAAM,QAAQ,EAAE,KAAK,CAAC,UAAU,CAAC,QAAQ;AACzC,MAAM,OAAO,EAAE,KAAK,CAAC,UAAU,CAAC,OAAO;AACvC,MAAM,gBAAgB,EAAE,OAAO,CAAC,OAAO,CAAC,4BAA4B;AACpE;AACA,GAAG,CAAC;AACJ;;;;"}