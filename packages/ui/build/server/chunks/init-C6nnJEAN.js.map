{"version":3,"file":"init-C6nnJEAN.js","sources":["../../../.svelte-kit/adapter-node/chunks/init.js"],"sourcesContent":["import { b as building } from \"./environment.js\";\nimport { c as createLogger } from \"./stack-spec.js\";\nimport { C as COMPOSE_FILE_PATH, D as DATA_ENV_PATH, c as STATE_ROOT, d as SYSTEM_ENV_PATH, R as RUNTIME_ENV_PATH, e as STACK_SPEC_PATH, S as SECRETS_ENV_PATH, f as CONFIG_ROOT, g as DATA_ROOT, h as DATA_DIR, A as ADMIN_TOKEN, i as DEFAULT_INSECURE_TOKEN } from \"./config.js\";\nimport \"./index.js\";\nconst log = createLogger(\"admin\");\nlet _setupManager;\nlet _stackManager;\nlet _initialized = false;\nasync function getSetupManager() {\n  if (!_setupManager) {\n    const { SetupManager } = await import(\"./setup-manager.js\");\n    _setupManager = new SetupManager(DATA_DIR, { stackSpecPath: STACK_SPEC_PATH });\n  }\n  return _setupManager;\n}\nasync function getStackManager() {\n  if (!_stackManager) {\n    const { StackManager } = await import(\"./stack-manager.js\");\n    _stackManager = new StackManager({\n      stateRootPath: STATE_ROOT,\n      dataRootPath: DATA_ROOT,\n      configRootPath: CONFIG_ROOT,\n      caddyJsonPath: `${STATE_ROOT}/caddy.json`,\n      secretsEnvPath: SECRETS_ENV_PATH,\n      stackSpecPath: STACK_SPEC_PATH,\n      runtimeEnvPath: RUNTIME_ENV_PATH,\n      systemEnvPath: SYSTEM_ENV_PATH,\n      gatewayEnvPath: `${STATE_ROOT}/gateway/.env`,\n      openmemoryEnvPath: `${STATE_ROOT}/openmemory/.env`,\n      postgresEnvPath: `${STATE_ROOT}/postgres/.env`,\n      qdrantEnvPath: `${STATE_ROOT}/qdrant/.env`,\n      assistantEnvPath: `${STATE_ROOT}/assistant/.env`,\n      dataEnvPath: DATA_ENV_PATH,\n      composeFilePath: COMPOSE_FILE_PATH\n    });\n  }\n  return _stackManager;\n}\nasync function ensureInitialized() {\n  if (_initialized || building) return;\n  _initialized = true;\n  const sm = await getStackManager();\n  const { CORE_AUTOMATIONS } = await import(\"./index2.js\");\n  const { ensureCronDirs, syncAutomations, configureCronDir } = await import(\"./automations.js\");\n  const { configureCronDir: configureHistoryCronDir } = await import(\"./automation-history.js\");\n  const cronDir = `${STATE_ROOT}/automations`;\n  configureCronDir(cronDir);\n  configureHistoryCronDir(cronDir);\n  const spec = sm.getSpec();\n  let changed = false;\n  for (const core of CORE_AUTOMATIONS) {\n    if (!spec.automations.some((a) => a.id === core.id)) {\n      spec.automations.push({ ...core, core: true });\n      changed = true;\n    }\n  }\n  if (changed) {\n    sm.setSpec(spec);\n  }\n  ensureCronDirs();\n  syncAutomations(sm.listAutomations());\n  if (ADMIN_TOKEN === DEFAULT_INSECURE_TOKEN) {\n    log.warn(\n      \"Default admin token detected. Set ADMIN_TOKEN environment variable before exposing to network.\"\n    );\n  }\n}\nasync function allChannelServiceNames() {\n  const sm = await getStackManager();\n  return sm.listChannelNames().map((name) => `channel-${name}`);\n}\nasync function allServiceNames() {\n  const sm = await getStackManager();\n  return sm.listServiceNames().map((name) => `service-${name}`);\n}\nasync function knownServices() {\n  const { allowedServiceSet, filterUiManagedServices } = await import(\"./compose-runner.js\");\n  const base = await allowedServiceSet();\n  for (const svc of await allChannelServiceNames()) base.add(svc);\n  for (const svc of await allServiceNames()) base.add(svc);\n  return new Set(filterUiManagedServices(Array.from(base)));\n}\nexport {\n  getSetupManager as a,\n  allChannelServiceNames as b,\n  ensureInitialized as e,\n  getStackManager as g,\n  knownServices as k,\n  log as l\n};\n"],"names":[],"mappings":";;;;;AAIK,MAAC,GAAG,GAAG,YAAY,CAAC,OAAO;AAChC,IAAI,aAAa;AACjB,IAAI,aAAa;AACjB,IAAI,YAAY,GAAG,KAAK;AACxB,eAAe,eAAe,GAAG;AACjC,EAAE,IAAI,CAAC,aAAa,EAAE;AACtB,IAAI,MAAM,EAAE,YAAY,EAAE,GAAG,MAAM,OAAO,6BAAoB,CAAC;AAC/D,IAAI,aAAa,GAAG,IAAI,YAAY,CAAC,QAAQ,EAAE,EAAE,aAAa,EAAE,eAAe,EAAE,CAAC;AAClF,EAAE;AACF,EAAE,OAAO,aAAa;AACtB;AACA,eAAe,eAAe,GAAG;AACjC,EAAE,IAAI,CAAC,aAAa,EAAE;AACtB,IAAI,MAAM,EAAE,YAAY,EAAE,GAAG,MAAM,OAAO,6BAAoB,CAAC;AAC/D,IAAI,aAAa,GAAG,IAAI,YAAY,CAAC;AACrC,MAAM,aAAa,EAAE,UAAU;AAC/B,MAAM,YAAY,EAAE,SAAS;AAC7B,MAAM,cAAc,EAAE,WAAW;AACjC,MAAM,aAAa,EAAE,CAAC,EAAE,UAAU,CAAC,WAAW,CAAC;AAC/C,MAAM,cAAc,EAAE,gBAAgB;AACtC,MAAM,aAAa,EAAE,eAAe;AACpC,MAAM,cAAc,EAAE,gBAAgB;AACtC,MAAM,aAAa,EAAE,eAAe;AACpC,MAAM,cAAc,EAAE,CAAC,EAAE,UAAU,CAAC,aAAa,CAAC;AAClD,MAAM,iBAAiB,EAAE,CAAC,EAAE,UAAU,CAAC,gBAAgB,CAAC;AACxD,MAAM,eAAe,EAAE,CAAC,EAAE,UAAU,CAAC,cAAc,CAAC;AACpD,MAAM,aAAa,EAAE,CAAC,EAAE,UAAU,CAAC,YAAY,CAAC;AAChD,MAAM,gBAAgB,EAAE,CAAC,EAAE,UAAU,CAAC,eAAe,CAAC;AACtD,MAAM,WAAW,EAAE,aAAa;AAChC,MAAM,eAAe,EAAE;AACvB,KAAK,CAAC;AACN,EAAE;AACF,EAAE,OAAO,aAAa;AACtB;AACA,eAAe,iBAAiB,GAAG;AACnC,EAAE,IAAI,YAAY,IAAI,QAAQ,EAAE;AAChC,EAAE,YAAY,GAAG,IAAI;AACrB,EAAE,MAAM,EAAE,GAAG,MAAM,eAAe,EAAE;AACpC,EAAE,MAAM,EAAE,gBAAgB,EAAE,GAAG,MAAM,OAAO,sBAAa,CAAC;AAC1D,EAAE,MAAM,EAAE,cAAc,EAAE,eAAe,EAAE,gBAAgB,EAAE,GAAG,MAAM,OAAO,2BAAkB,CAAC;AAChG,EAAE,MAAM,EAAE,gBAAgB,EAAE,uBAAuB,EAAE,GAAG,MAAM,OAAO,kCAAyB,CAAC;AAC/F,EAAE,MAAM,OAAO,GAAG,CAAC,EAAE,UAAU,CAAC,YAAY,CAAC;AAC7C,EAAE,gBAAgB,CAAC,OAAO,CAAC;AAC3B,EAAE,uBAAuB,CAAC,OAAO,CAAC;AAClC,EAAE,MAAM,IAAI,GAAG,EAAE,CAAC,OAAO,EAAE;AAC3B,EAAE,IAAI,OAAO,GAAG,KAAK;AACrB,EAAE,KAAK,MAAM,IAAI,IAAI,gBAAgB,EAAE;AACvC,IAAI,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,KAAK,IAAI,CAAC,EAAE,CAAC,EAAE;AACzD,MAAM,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE,GAAG,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC;AACpD,MAAM,OAAO,GAAG,IAAI;AACpB,IAAI;AACJ,EAAE;AACF,EAAE,IAAI,OAAO,EAAE;AACf,IAAI,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC;AACpB,EAAE;AACF,EAAE,cAAc,EAAE;AAClB,EAAE,eAAe,CAAC,EAAE,CAAC,eAAe,EAAE,CAAC;AACvC,EAAE,IAAI,WAAW,KAAK,sBAAsB,EAAE;AAC9C,IAAI,GAAG,CAAC,IAAI;AACZ,MAAM;AACN,KAAK;AACL,EAAE;AACF;AACA,eAAe,sBAAsB,GAAG;AACxC,EAAE,MAAM,EAAE,GAAG,MAAM,eAAe,EAAE;AACpC,EAAE,OAAO,EAAE,CAAC,gBAAgB,EAAE,CAAC,GAAG,CAAC,CAAC,IAAI,KAAK,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC,CAAC;AAC/D;AACA,eAAe,eAAe,GAAG;AACjC,EAAE,MAAM,EAAE,GAAG,MAAM,eAAe,EAAE;AACpC,EAAE,OAAO,EAAE,CAAC,gBAAgB,EAAE,CAAC,GAAG,CAAC,CAAC,IAAI,KAAK,CAAC,QAAQ,EAAE,IAAI,CAAC,CAAC,CAAC;AAC/D;AACA,eAAe,aAAa,GAAG;AAC/B,EAAE,MAAM,EAAE,iBAAiB,EAAE,uBAAuB,EAAE,GAAG,MAAM,OAAO,8BAAqB,CAAC;AAC5F,EAAE,MAAM,IAAI,GAAG,MAAM,iBAAiB,EAAE;AACxC,EAAE,KAAK,MAAM,GAAG,IAAI,MAAM,sBAAsB,EAAE,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC;AACjE,EAAE,KAAK,MAAM,GAAG,IAAI,MAAM,eAAe,EAAE,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,CAAC;AAC1D,EAAE,OAAO,IAAI,GAAG,CAAC,uBAAuB,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;AAC3D;;;;"}