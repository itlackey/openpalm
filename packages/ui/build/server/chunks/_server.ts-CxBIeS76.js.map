{"version":3,"file":"_server.ts-CxBIeS76.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/setup/health-check/_server.ts.js"],"sourcesContent":["import { j as json } from \"../../../../chunks/json.js\";\nimport { a as getSetupManager } from \"../../../../chunks/init.js\";\nimport { e as readRuntimeEnv } from \"../../../../chunks/env-helpers.js\";\nimport { i as isLocalRequest } from \"../../../../chunks/auth.js\";\nimport { G as GATEWAY_URL, O as OPENPALM_ASSISTANT_URL, a as OPENMEMORY_URL } from \"../../../../chunks/config.js\";\nasync function checkServiceHealth(url, expectJson = true) {\n  try {\n    const resp = await fetch(url, { signal: AbortSignal.timeout(3e3) });\n    if (!resp.ok) return { ok: false, error: `status ${resp.status}` };\n    if (!expectJson) return { ok: true, time: (/* @__PURE__ */ new Date()).toISOString() };\n    const body = await resp.json();\n    return { ok: body.ok ?? true, time: body.time };\n  } catch (e) {\n    return { ok: false, error: String(e) };\n  }\n}\nconst GET = async ({ request }) => {\n  const setupManager = await getSetupManager();\n  const state = setupManager.getState();\n  if (!state.completed && !isLocalRequest(request)) {\n    return json(403, { error: \"setup endpoints are restricted to local network access\" });\n  }\n  const runtime = readRuntimeEnv();\n  const serviceInstances = {\n    openmemory: runtime.OPENMEMORY_URL ?? state.serviceInstances.openmemory ?? \"\",\n    psql: runtime.OPENMEMORY_POSTGRES_URL ?? state.serviceInstances.psql ?? \"\",\n    qdrant: runtime.OPENMEMORY_QDRANT_URL ?? state.serviceInstances.qdrant ?? \"\"\n  };\n  const openmemoryBaseUrl = serviceInstances.openmemory || OPENMEMORY_URL;\n  const [gateway, assistant, openmemory] = await Promise.all([\n    checkServiceHealth(`${GATEWAY_URL}/health`),\n    checkServiceHealth(`${OPENPALM_ASSISTANT_URL}/`, false),\n    checkServiceHealth(`${openmemoryBaseUrl}/api/v1/config/`)\n  ]);\n  return json(200, {\n    services: {\n      gateway,\n      assistant,\n      openmemory,\n      admin: { ok: true, time: (/* @__PURE__ */ new Date()).toISOString() }\n    },\n    serviceInstances\n  });\n};\nexport {\n  GET\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAKA,eAAe,kBAAkB,CAAC,GAAG,EAAE,UAAU,GAAG,IAAI,EAAE;AAC1D,EAAE,IAAI;AACN,IAAI,MAAM,IAAI,GAAG,MAAM,KAAK,CAAC,GAAG,EAAE,EAAE,MAAM,EAAE,WAAW,CAAC,OAAO,CAAC,GAAG,CAAC,EAAE,CAAC;AACvE,IAAI,IAAI,CAAC,IAAI,CAAC,EAAE,EAAE,OAAO,EAAE,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,OAAO,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,EAAE;AACtE,IAAI,IAAI,CAAC,UAAU,EAAE,OAAO,EAAE,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,iBAAiB,IAAI,IAAI,EAAE,EAAE,WAAW,EAAE,EAAE;AAC1F,IAAI,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,IAAI,EAAE;AAClC,IAAI,OAAO,EAAE,EAAE,EAAE,IAAI,CAAC,EAAE,IAAI,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE;AACnD,EAAE,CAAC,CAAC,OAAO,CAAC,EAAE;AACd,IAAI,OAAO,EAAE,EAAE,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,CAAC,CAAC,CAAC,EAAE;AAC1C,EAAE;AACF;AACK,MAAC,GAAG,GAAG,OAAO,EAAE,OAAO,EAAE,KAAK;AACnC,EAAE,MAAM,YAAY,GAAG,MAAM,eAAe,EAAE;AAC9C,EAAE,MAAM,KAAK,GAAG,YAAY,CAAC,QAAQ,EAAE;AACvC,EAAE,IAAI,CAAC,KAAK,CAAC,SAAS,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,EAAE;AACpD,IAAI,OAAO,IAAI,CAAC,GAAG,EAAE,EAAE,KAAK,EAAE,wDAAwD,EAAE,CAAC;AACzF,EAAE;AACF,EAAE,MAAM,OAAO,GAAG,cAAc,EAAE;AAClC,EAAE,MAAM,gBAAgB,GAAG;AAC3B,IAAI,UAAU,EAAE,OAAO,CAAC,cAAc,IAAI,KAAK,CAAC,gBAAgB,CAAC,UAAU,IAAI,EAAE;AACjF,IAAI,IAAI,EAAE,OAAO,CAAC,uBAAuB,IAAI,KAAK,CAAC,gBAAgB,CAAC,IAAI,IAAI,EAAE;AAC9E,IAAI,MAAM,EAAE,OAAO,CAAC,qBAAqB,IAAI,KAAK,CAAC,gBAAgB,CAAC,MAAM,IAAI;AAC9E,GAAG;AACH,EAAE,MAAM,iBAAiB,GAAG,gBAAgB,CAAC,UAAU,IAAI,cAAc;AACzE,EAAE,MAAM,CAAC,OAAO,EAAE,SAAS,EAAE,UAAU,CAAC,GAAG,MAAM,OAAO,CAAC,GAAG,CAAC;AAC7D,IAAI,kBAAkB,CAAC,CAAC,EAAE,WAAW,CAAC,OAAO,CAAC,CAAC;AAC/C,IAAI,kBAAkB,CAAC,CAAC,EAAE,sBAAsB,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC;AAC3D,IAAI,kBAAkB,CAAC,CAAC,EAAE,iBAAiB,CAAC,eAAe,CAAC;AAC5D,GAAG,CAAC;AACJ,EAAE,OAAO,IAAI,CAAC,GAAG,EAAE;AACnB,IAAI,QAAQ,EAAE;AACd,MAAM,OAAO;AACb,MAAM,SAAS;AACf,MAAM,UAAU;AAChB,MAAM,KAAK,EAAE,EAAE,EAAE,EAAE,IAAI,EAAE,IAAI,EAAE,iBAAiB,IAAI,IAAI,EAAE,EAAE,WAAW,EAAE;AACzE,KAAK;AACL,IAAI;AACJ,GAAG,CAAC;AACJ;;;;"}