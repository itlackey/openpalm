{"version":3,"file":"automation-history-CctHM2Up.js","sources":["../../../.svelte-kit/adapter-node/chunks/automation-history.js"],"sourcesContent":["import { existsSync, readFileSync } from \"node:fs\";\nimport { join } from \"node:path\";\nconst DEFAULT_CRON_DIR = \"/state/automations\";\nlet _cronDir = DEFAULT_CRON_DIR;\nfunction configureCronDir(dir) {\n  _cronDir = dir;\n}\nfunction readHistory(id, limit = 20, cronDir = _cronDir) {\n  const path = join(cronDir, \"log\", `${id}.jsonl`);\n  if (!existsSync(path)) return [];\n  const lines = readFileSync(path, \"utf8\").split(\"\\n\").filter((line) => line.trim().length > 0);\n  const runs = [];\n  for (let i = lines.length - 1; i >= 0 && runs.length < limit; i--) {\n    try {\n      runs.push(JSON.parse(lines[i]));\n    } catch {\n    }\n  }\n  return runs;\n}\nfunction getLatestRun(id, cronDir = _cronDir) {\n  const runs = readHistory(id, 1, cronDir);\n  return runs[0] ?? null;\n}\nexport {\n  configureCronDir,\n  getLatestRun,\n  readHistory\n};\n"],"names":[],"mappings":";;;AAEA,MAAM,gBAAgB,GAAG,oBAAoB;AAC7C,IAAI,QAAQ,GAAG,gBAAgB;AAC/B,SAAS,gBAAgB,CAAC,GAAG,EAAE;AAC/B,EAAE,QAAQ,GAAG,GAAG;AAChB;AACA,SAAS,WAAW,CAAC,EAAE,EAAE,KAAK,GAAG,EAAE,EAAE,OAAO,GAAG,QAAQ,EAAE;AACzD,EAAE,MAAM,IAAI,GAAG,IAAI,CAAC,OAAO,EAAE,KAAK,EAAE,CAAC,EAAE,EAAE,CAAC,MAAM,CAAC,CAAC;AAClD,EAAE,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE;AAClC,EAAE,MAAM,KAAK,GAAG,YAAY,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,MAAM,CAAC,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,EAAE,CAAC,MAAM,GAAG,CAAC,CAAC;AAC/F,EAAE,MAAM,IAAI,GAAG,EAAE;AACjB,EAAE,KAAK,IAAI,CAAC,GAAG,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,MAAM,GAAG,KAAK,EAAE,CAAC,EAAE,EAAE;AACrE,IAAI,IAAI;AACR,MAAM,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;AACrC,IAAI,CAAC,CAAC,MAAM;AACZ,IAAI;AACJ,EAAE;AACF,EAAE,OAAO,IAAI;AACb;AACA,SAAS,YAAY,CAAC,EAAE,EAAE,OAAO,GAAG,QAAQ,EAAE;AAC9C,EAAE,MAAM,IAAI,GAAG,WAAW,CAAC,EAAE,EAAE,CAAC,EAAE,OAAO,CAAC;AAC1C,EAAE,OAAO,IAAI,CAAC,CAAC,CAAC,IAAI,IAAI;AACxB;;;;"}