{"version":3,"file":"stack-apply-engine-CX7GxTsE.js","sources":["../../../.svelte-kit/adapter-node/chunks/stack-apply-engine.js"],"sourcesContent":["import { existsSync, readFileSync, mkdirSync, writeFileSync } from \"node:fs\";\nimport { dirname, join } from \"node:path\";\nimport { createComposeRunner } from \"./compose-runner.js\";\nimport { u as updateRuntimeEnvContent } from \"./runtime-env.js\";\nasync function applyStack(manager, options) {\n  const runner = options?.runner ?? createComposeRunner(manager.getPaths().runtimeEnvPath);\n  const generated = manager.renderPreview();\n  const secretErrors = manager.validateReferencedSecrets();\n  if (secretErrors.length > 0) {\n    throw new Error(`secret_validation_failed:${secretErrors.join(\",\")}`);\n  }\n  const warnings = [];\n  if (options?.apply ?? true) {\n    const runtimeEnvPath = manager.getPaths().runtimeEnvPath;\n    const existingRuntime = existsSync(runtimeEnvPath) ? readFileSync(runtimeEnvPath, \"utf8\") : \"\";\n    const updatedRuntime = updateRuntimeEnvContent(existingRuntime, manager.getRuntimeEnvEntries());\n    mkdirSync(dirname(runtimeEnvPath), { recursive: true });\n    writeFileSync(runtimeEnvPath, updatedRuntime, \"utf8\");\n    const tempComposePath = join(manager.getPaths().stateRootPath, \"docker-compose.yml.next\");\n    writeFileSync(tempComposePath, generated.composeFile, \"utf8\");\n    const composeValidate = await runner.configValidateForFile(tempComposePath);\n    if (!composeValidate.ok) {\n      throw new Error(`compose_validation_failed:${composeValidate.stderr}`);\n    }\n    manager.renderArtifacts(generated);\n  }\n  return { ok: true, generated, warnings };\n}\nexport {\n  applyStack as a\n};\n"],"names":[],"mappings":";;;;;AAIA,eAAe,UAAU,CAAC,OAAO,EAAE,OAAO,EAAE;AAC5C,EAAE,MAAM,MAAM,GAAG,OAAO,EAAE,MAAM,IAAI,mBAAmB,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,cAAc,CAAC;AAC1F,EAAE,MAAM,SAAS,GAAG,OAAO,CAAC,aAAa,EAAE;AAC3C,EAAE,MAAM,YAAY,GAAG,OAAO,CAAC,yBAAyB,EAAE;AAC1D,EAAE,IAAI,YAAY,CAAC,MAAM,GAAG,CAAC,EAAE;AAC/B,IAAI,MAAM,IAAI,KAAK,CAAC,CAAC,yBAAyB,EAAE,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;AACzE,EAAE;AACF,EAAE,MAAM,QAAQ,GAAG,EAAE;AACrB,EAAE,IAAI,OAAO,EAAE,KAAK,IAAI,IAAI,EAAE;AAC9B,IAAI,MAAM,cAAc,GAAG,OAAO,CAAC,QAAQ,EAAE,CAAC,cAAc;AAC5D,IAAI,MAAM,eAAe,GAAG,UAAU,CAAC,cAAc,CAAC,GAAG,YAAY,CAAC,cAAc,EAAE,MAAM,CAAC,GAAG,EAAE;AAClG,IAAI,MAAM,cAAc,GAAG,uBAAuB,CAAC,eAAe,EAAE,OAAO,CAAC,oBAAoB,EAAE,CAAC;AACnG,IAAI,SAAS,CAAC,OAAO,CAAC,cAAc,CAAC,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC;AAC3D,IAAI,aAAa,CAAC,cAAc,EAAE,cAAc,EAAE,MAAM,CAAC;AACzD,IAAI,MAAM,eAAe,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,aAAa,EAAE,yBAAyB,CAAC;AAC7F,IAAI,aAAa,CAAC,eAAe,EAAE,SAAS,CAAC,WAAW,EAAE,MAAM,CAAC;AACjE,IAAI,MAAM,eAAe,GAAG,MAAM,MAAM,CAAC,qBAAqB,CAAC,eAAe,CAAC;AAC/E,IAAI,IAAI,CAAC,eAAe,CAAC,EAAE,EAAE;AAC7B,MAAM,MAAM,IAAI,KAAK,CAAC,CAAC,0BAA0B,EAAE,eAAe,CAAC,MAAM,CAAC,CAAC,CAAC;AAC5E,IAAI;AACJ,IAAI,OAAO,CAAC,eAAe,CAAC,SAAS,CAAC;AACtC,EAAE;AACF,EAAE,OAAO,EAAE,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,QAAQ,EAAE;AAC1C;;;;"}