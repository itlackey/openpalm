services:
  opencode-core:
    build: ./opencode
    # Extensions are baked into the image from opencode/extensions/.
    # For local dev, layer this over assets/state/docker-compose.yml.
    environment:
      # OpenMemory HTTP API plugin configuration
      OPENPALM_MEMORY_MODE: "api"
      OPENMEMORY_BASE_URL: "http://openmemory:8765"
      # OPENMEMORY_API_KEY: ""        # set in .env or secrets if auth is enabled
      RECALL_LIMIT: "5"
      RECALL_MAX_CHARS: "2000"
      WRITEBACK_ENABLED: "true"
      TEMPORAL_ENABLED: "false"

  gateway:
    build: ./gateway

  admin:
    build: ./admin

  channel-chat:
    build: ./channels/chat

  channel-discord:
    build: ./channels/discord

  channel-voice:
    build: ./channels/voice

  channel-telegram:
    build: ./channels/telegram
