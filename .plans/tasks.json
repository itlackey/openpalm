[
  {
    "id": "rec-01",
    "title": "Remove overlapping startup code paths",
    "description": "Consolidate setup startup so non-terminal setup actions do not start runtime services and completion is the single startup trigger.",
    "status": "pending",
    "references": [
      { "file": "packages/ui/src/routes/command/+server.ts", "lineStart": 49, "lineEnd": 362 },
      { "file": "packages/ui/src/routes/setup/complete/+server.ts", "lineStart": 15, "lineEnd": 42 },
      { "file": "packages/ui/src/lib/components/SetupWizard.svelte", "line": 149 },
      { "file": "packages/lib/src/admin/compose-runner.ts", "line": 4 }
    ],
    "subtasks": [
      {
        "id": "rec-01-01",
        "description": "Create a shared setup completion orchestrator used by both completion endpoints.",
        "status": "completed",
        "references": [
          { "file": "packages/ui/src/routes/command/+server.ts", "line": 348 },
          { "file": "packages/ui/src/routes/setup/complete/+server.ts", "line": 28 }
        ]
      },
      {
        "id": "rec-01-02",
        "description": "Remove the setup.start_core command branch and detached startup logic.",
        "status": "completed",
        "references": [
          { "file": "packages/ui/src/routes/command/+server.ts", "lineStart": 205, "lineEnd": 234 }
        ]
      },
      {
        "id": "rec-01-03",
        "description": "Remove wizard invocation of setup.start_core and keep startup messaging on finalization.",
        "status": "completed",
        "references": [
          { "file": "packages/ui/src/lib/components/SetupWizard.svelte", "line": 149 },
          { "file": "packages/ui/src/lib/components/SetupWizard.svelte", "line": 218 }
        ]
      },
      {
        "id": "rec-01-04",
        "description": "Make setup.access_scope and setup.profile configuration-only without compose up side effects.",
        "status": "completed",
        "references": [
          { "file": "packages/ui/src/routes/command/+server.ts", "line": 236 },
          { "file": "packages/ui/src/routes/command/+server.ts", "line": 267 },
          { "file": "packages/ui/src/routes/setup/access-scope/+server.ts", "line": 25 }
        ]
      },
      {
        "id": "rec-01-05",
        "description": "Replace route-local setup service arrays with canonical lib-derived service definitions.",
        "status": "pending",
        "references": [
          { "file": "packages/lib/src/admin/compose-runner.ts", "line": 4 },
          { "file": "packages/ui/src/routes/command/+server.ts", "line": 49 },
          { "file": "packages/ui/src/routes/setup/complete/+server.ts", "line": 15 }
        ]
      },
      {
        "id": "rec-01-06",
        "description": "Update setup docs and tests to enforce one startup path and no setup.start_core usage.",
        "status": "pending",
        "references": [
          { "file": "docs/cli.md", "lineStart": 147, "lineEnd": 156 },
          { "file": "packages/ui/src/routes/command/command-setup-flow.test.ts", "line": 1 },
          { "file": "packages/ui/test/api/03-setup-api.test.ts", "line": 171 }
        ]
      }
    ]
  },
  {
    "id": "rec-02",
    "title": "Add ensureCoreServicesReady health gate",
    "description": "Gate setup completion on full core runtime convergence with typed diagnostics and Docker-first error visibility.",
    "status": "pending",
    "references": [
      { "file": "packages/lib/src/admin/compose-runner.ts", "line": 4 },
      { "file": "packages/ui/src/routes/command/+server.ts", "line": 348 },
      { "file": "packages/ui/src/routes/setup/health-check/+server.ts", "line": 13 },
      { "file": "packages/lib/src/admin/stack-apply-engine.ts", "line": 14 }
    ],
    "subtasks": [
      {
        "id": "rec-02-01",
        "description": "Implement packages/lib/src/admin/core-readiness.ts with ensureCoreServicesReady and typed result contracts.",
        "status": "pending",
        "references": [
          { "file": "packages/lib/src/admin/compose-runner.ts", "line": 46 },
          { "file": "packages/lib/src/types.ts", "line": 18 }
        ]
      },
      {
        "id": "rec-02-02",
        "description": "Add bounded polling that checks compose ps state and health semantics for each target service.",
        "status": "pending",
        "references": [
          { "file": "packages/lib/src/admin/compose-runner.ts", "line": 147 },
          { "file": "packages/lib/src/admin/compose-runner.ts", "line": 153 }
        ]
      },
      {
        "id": "rec-02-03",
        "description": "Integrate HTTP readiness probes for admin, gateway, assistant, and openmemory into convergence checks.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/lib/server/health.ts", "line": 1 },
          { "file": "packages/ui/src/routes/setup/health-check/+server.ts", "line": 22 }
        ]
      },
      {
        "id": "rec-02-04",
        "description": "Collect failed-service logs and raw compose stderr into setup_not_ready diagnostics payloads.",
        "status": "pending",
        "references": [
          { "file": "packages/lib/src/admin/compose-runner.ts", "line": 55 },
          { "file": "packages/lib/src/types.ts", "line": 18 }
        ]
      },
      {
        "id": "rec-02-05",
        "description": "Wire setup.complete endpoints to readiness gate and call completeSetup only on readiness success.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/routes/command/+server.ts", "line": 362 },
          { "file": "packages/ui/src/routes/setup/complete/+server.ts", "line": 17 },
          { "file": "packages/lib/src/admin/setup-manager.ts", "line": 151 }
        ]
      },
      {
        "id": "rec-02-06",
        "description": "Add lib, route, API, and E2E tests for convergence success, timeout, and compose failure paths.",
        "status": "pending",
        "references": [
          { "file": "packages/lib/src/admin/compose-runner.ts", "line": 94 },
          { "file": "packages/ui/src/routes/command/command-setup-flow.test.ts", "line": 1 },
          { "file": "test/install-e2e/happy-path.docker.ts", "line": 379 }
        ]
      }
    ]
  },
  {
    "id": "rec-03",
    "title": "Make setup.complete authoritative transition",
    "description": "Enforce setup completion invariants so setup state is completed only after stack apply and runtime readiness succeed.",
    "status": "pending",
    "references": [
      { "file": "packages/ui/src/routes/command/+server.ts", "lineStart": 348, "lineEnd": 362 },
      { "file": "packages/ui/src/routes/setup/complete/+server.ts", "lineStart": 15, "lineEnd": 42 },
      { "file": "packages/lib/src/admin/setup-manager.ts", "line": 151 }
    ],
    "subtasks": [
      {
        "id": "rec-03-01",
        "description": "Introduce a shared finalizeSetup orchestration API in lib/admin with strict operation ordering.",
        "status": "pending",
        "references": [
          { "file": "packages/lib/src/admin/stack-apply-engine.ts", "line": 22 },
          { "file": "packages/lib/src/admin/setup-manager.ts", "line": 151 }
        ]
      },
      {
        "id": "rec-03-02",
        "description": "Centralize setup startup service derivation from CoreServices and remove route-local lists.",
        "status": "pending",
        "references": [
          { "file": "packages/lib/src/admin/compose-runner.ts", "line": 4 },
          { "file": "packages/ui/src/routes/command/+server.ts", "line": 49 }
        ]
      },
      {
        "id": "rec-03-03",
        "description": "Return stable setup_not_ready failure payloads with consistent HTTP status behavior.",
        "status": "pending",
        "references": [
          { "file": "dev/docs/api-reference.md", "line": 33 },
          { "file": "packages/lib/src/types.ts", "line": 18 }
        ]
      },
      {
        "id": "rec-03-04",
        "description": "Refactor /command setup.complete path to use orchestrator and remove non-terminal startup side effects.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/routes/command/+server.ts", "line": 205 },
          { "file": "packages/ui/src/routes/command/+server.ts", "line": 236 },
          { "file": "packages/ui/src/routes/command/+server.ts", "line": 348 }
        ]
      },
      {
        "id": "rec-03-05",
        "description": "Refactor /setup/complete and /setup/access-scope routes to delegate and remain mutation-only.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/routes/setup/complete/+server.ts", "line": 15 },
          { "file": "packages/ui/src/routes/setup/access-scope/+server.ts", "line": 25 }
        ]
      },
      {
        "id": "rec-03-06",
        "description": "Update docs and tests to verify invariants, endpoint parity, and completion-only state promotion.",
        "status": "pending",
        "references": [
          { "file": "docs/cli.md", "line": 151 },
          { "file": "packages/ui/test/api/03-setup-api.test.ts", "line": 171 },
          { "file": "test/install-e2e/happy-path.docker.ts", "line": 379 }
        ]
      }
    ]
  },
  {
    "id": "rec-04",
    "title": "Remove fire-and-forget setup.start_core",
    "description": "Eliminate detached startup behavior and keep startup/failure semantics synchronous at setup completion.",
    "status": "pending",
    "references": [
      { "file": "packages/ui/src/routes/command/+server.ts", "lineStart": 205, "lineEnd": 234 },
      { "file": "packages/ui/src/lib/components/SetupWizard.svelte", "line": 149 },
      { "file": "docs/cli.md", "line": 151 }
    ],
    "subtasks": [
      {
        "id": "rec-04-01",
        "description": "Remove setup.start_core command implementation and detached async startup return path.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/routes/command/+server.ts", "line": 205 }
        ]
      },
      {
        "id": "rec-04-02",
        "description": "Remove setup.start_core call from wizard service-instances step.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/lib/components/SetupWizard.svelte", "line": 149 }
        ]
      },
      {
        "id": "rec-04-03",
        "description": "Keep setup.complete as synchronous startup boundary with explicit structured failure responses.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/routes/command/+server.ts", "lineStart": 348, "lineEnd": 360 }
        ]
      },
      {
        "id": "rec-04-04",
        "description": "Ensure /setup/complete parity and confirm no residual startup triggers in setup subroutes.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/routes/setup/complete/+server.ts", "line": 39 },
          { "file": "packages/ui/src/routes/setup/access-scope/+server.ts", "line": 25 }
        ]
      },
      {
        "id": "rec-04-05",
        "description": "Decide and implement compatibility behavior: temporary no-op deprecation shim or immediate unknown_command removal.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/routes/command/+server.ts", "line": 680 },
          { "file": "packages/ui/test/api/08-command-api.test.ts", "line": 49 }
        ]
      },
      {
        "id": "rec-04-06",
        "description": "Update tests and docs to remove setup.start_core narrative and validate wizard flow behavior.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/routes/command/command-setup-flow.test.ts", "line": 5 },
          { "file": "packages/ui/e2e/10-setup-wizard-ui.pw.ts", "line": 156 },
          { "file": "docs/cli.md", "line": 147 }
        ]
      }
    ]
  },
  {
    "id": "rec-05",
    "title": "Collapse startup entry points to one path",
    "description": "Route all setup-time runtime startup through one shared backend orchestration function used by completion endpoints.",
    "status": "pending",
    "references": [
      { "file": "packages/lib/src/admin/compose-runner.ts", "line": 4 },
      { "file": "packages/ui/src/routes/command/+server.ts", "line": 348 },
      { "file": "packages/ui/src/routes/setup/complete/+server.ts", "line": 15 }
    ],
    "subtasks": [
      {
        "id": "rec-05-01",
        "description": "Add shared reconcileCoreRuntime function in lib compose/admin layer with structured result typing.",
        "status": "pending",
        "references": [
          { "file": "packages/lib/src/admin/compose-runner.ts", "lineStart": 4, "lineEnd": 66 }
        ]
      },
      {
        "id": "rec-05-02",
        "description": "Delete setup.start_core entry point and related wizard fire-and-forget caller.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/routes/command/+server.ts", "line": 205 },
          { "file": "packages/ui/src/lib/components/SetupWizard.svelte", "line": 149 }
        ]
      },
      {
        "id": "rec-05-03",
        "description": "Remove startup side effects from command and REST access-scope handlers.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/routes/command/+server.ts", "line": 236 },
          { "file": "packages/ui/src/routes/setup/access-scope/+server.ts", "line": 25 }
        ]
      },
      {
        "id": "rec-05-04",
        "description": "Switch /command setup.complete and /setup/complete to call the same shared orchestration function.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/routes/command/+server.ts", "line": 348 },
          { "file": "packages/ui/src/routes/setup/complete/+server.ts", "line": 15 }
        ]
      },
      {
        "id": "rec-05-05",
        "description": "Update API, wizard-order, and install E2E tests to assert one startup path and removed legacy command.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/test/api/08-command-api.test.ts", "line": 40 },
          { "file": "packages/ui/src/lib/components/setup-wizard-order.test.ts", "line": 6 },
          { "file": "test/install-e2e/happy-path.docker.ts", "line": 379 }
        ]
      },
      {
        "id": "rec-05-06",
        "description": "Update release workflow assertions and docs to describe completion-only startup orchestration.",
        "status": "pending",
        "references": [
          { "file": ".github/workflows/release.yml", "line": 161 },
          { "file": "docs/cli.md", "line": 151 }
        ]
      }
    ]
  },
  {
    "id": "rec-06",
    "title": "Add core readiness UX stage",
    "description": "Introduce explicit final-step readiness phases, per-service status, diagnostics, and retry controls in setup UI.",
    "status": "pending",
    "references": [
      { "file": "packages/ui/src/lib/components/SetupWizard.svelte", "line": 184 },
      { "file": "packages/ui/src/lib/components/CompleteStep.svelte", "line": 11 },
      { "file": "packages/ui/src/routes/command/+server.ts", "line": 348 }
    ],
    "subtasks": [
      {
        "id": "rec-06-01",
        "description": "Define shared readiness phase and snapshot types for API and UI contracts.",
        "status": "pending",
        "references": [
          { "file": "packages/lib/src/types.ts", "line": 18 },
          { "file": "packages/lib/src/admin/setup-manager.ts", "line": 151 }
        ]
      },
      {
        "id": "rec-06-02",
        "description": "Implement backend readiness orchestration and typed setup.complete responses with phase snapshots.",
        "status": "pending",
        "references": [
          { "file": "packages/lib/src/admin/compose-runner.ts", "line": 4 },
          { "file": "packages/ui/src/routes/command/+server.ts", "line": 348 }
        ]
      },
      {
        "id": "rec-06-03",
        "description": "Add readiness status endpoints and retry endpoint under /setup/core-readiness.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/routes/setup/core-readiness/+server.ts", "line": 1 },
          { "file": "packages/ui/src/routes/setup/core-readiness/retry/+server.ts", "line": 1 }
        ]
      },
      {
        "id": "rec-06-04",
        "description": "Refactor SetupWizard finish flow to render backend-driven phases and gate success on ready.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/lib/components/SetupWizard.svelte", "line": 184 },
          { "file": "packages/ui/src/lib/components/SetupWizard.svelte", "line": 149 }
        ]
      },
      {
        "id": "rec-06-05",
        "description": "Enhance CompleteStep with per-service status, diagnostics panel, retry action, and copy diagnostics.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/lib/components/CompleteStep.svelte", "line": 16 },
          { "file": "packages/ui/src/lib/components/CompleteStep.svelte", "line": 65 }
        ]
      },
      {
        "id": "rec-06-06",
        "description": "Add accessibility and mobile regression tests for phase updates and failure recovery controls.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/lib/components/complete-step.test.ts", "line": 12 },
          { "file": "packages/ui/test/api/03-setup-api.test.ts", "line": 1 },
          { "file": "test/install-e2e/happy-path.docker.ts", "line": 379 }
        ]
      }
    ]
  },
  {
    "id": "rec-07",
    "title": "Add structured preflight failure types",
    "description": "Move install preflight handling from message parsing to typed codes and severities with compatibility shims.",
    "status": "pending",
    "references": [
      { "file": "packages/lib/src/preflight.ts", "lineStart": 4, "lineEnd": 126 },
      { "file": "packages/cli/src/commands/install.ts", "lineStart": 60, "lineEnd": 88 },
      { "file": "packages/lib/src/types.ts", "line": 18 }
    ],
    "subtasks": [
      {
        "id": "rec-07-01",
        "description": "Define PreflightCode, PreflightSeverity, PreflightIssue, and PreflightResult in shared lib types.",
        "status": "pending",
        "references": [
          { "file": "packages/lib/src/types.ts", "line": 18 },
          { "file": "packages/lib/src/index.ts", "line": 14 }
        ]
      },
      {
        "id": "rec-07-02",
        "description": "Implement runPreflightChecksDetailed and migrate check functions to return typed issues.",
        "status": "pending",
        "references": [
          { "file": "packages/lib/src/preflight.ts", "line": 33 },
          { "file": "packages/lib/src/preflight.ts", "line": 58 },
          { "file": "packages/lib/src/preflight.ts", "line": 108 }
        ]
      },
      {
        "id": "rec-07-03",
        "description": "Keep temporary runPreflightChecks compatibility shim mapping typed issues to legacy warnings.",
        "status": "pending",
        "references": [
          { "file": "packages/lib/src/preflight.ts", "line": 126 }
        ]
      },
      {
        "id": "rec-07-04",
        "description": "Refactor install command fatal branching to use preflight codes instead of message includes checks.",
        "status": "pending",
        "references": [
          { "file": "packages/cli/src/commands/install.ts", "line": 74 },
          { "file": "packages/cli/src/commands/install.ts", "line": 88 }
        ]
      },
      {
        "id": "rec-07-05",
        "description": "Add lib and CLI tests for mapping, severity contracts, and no message-parsing regression.",
        "status": "pending",
        "references": [
          { "file": "packages/lib/src/preflight.test.ts", "line": 1 },
          { "file": "packages/cli/src/commands/install.preflight-codes.test.ts", "line": 1 },
          { "file": "packages/cli/test/install.test.ts", "line": 48 }
        ]
      },
      {
        "id": "rec-07-06",
        "description": "Update docs and release workflow test coverage for typed preflight contract behavior.",
        "status": "pending",
        "references": [
          { "file": "docs/cli.md", "line": 48 },
          { "file": "dev/docs/api-reference.md", "line": 14 },
          { "file": ".github/workflows/release.yml", "line": 77 }
        ]
      }
    ]
  },
  {
    "id": "rec-08",
    "title": "Align installer --port option in wrappers",
    "description": "Add --port support and remediation guidance in install wrappers with docs and test parity.",
    "status": "pending",
    "references": [
      { "file": "install.sh", "lineStart": 28, "lineEnd": 74 },
      { "file": "install.ps1", "lineStart": 10, "lineEnd": 15 },
      { "file": "packages/cli/src/main.ts", "lineStart": 135, "lineEnd": 146 }
    ],
    "subtasks": [
      {
        "id": "rec-08-01",
        "description": "Update install.sh parser to accept --port and forward value to CLI args.",
        "status": "pending",
        "references": [
          { "file": "install.sh", "line": 28 },
          { "file": "install.sh", "line": 219 }
        ]
      },
      {
        "id": "rec-08-02",
        "description": "Add --port help text and wrapper usage examples in install.sh output.",
        "status": "pending",
        "references": [
          { "file": "install.sh", "lineStart": 13, "lineEnd": 17 },
          { "file": "install.sh", "lineStart": 53, "lineEnd": 64 }
        ]
      },
      {
        "id": "rec-08-03",
        "description": "Add Port parameter validation and --port pass-through in install.ps1.",
        "status": "pending",
        "references": [
          { "file": "install.ps1", "line": 10 },
          { "file": "install.ps1", "line": 108 },
          { "file": "install.ps1", "line": 125 }
        ]
      },
      {
        "id": "rec-08-04",
        "description": "Add PowerShell comment-based help entries for Port and alternate-port install examples.",
        "status": "pending",
        "references": [
          { "file": "install.ps1", "lineStart": 1, "lineEnd": 15 }
        ]
      },
      {
        "id": "rec-08-05",
        "description": "Add wrapper-level post-failure remediation hints for known port-conflict errors without masking CLI output.",
        "status": "pending",
        "references": [
          { "file": "install.sh", "lineStart": 218, "lineEnd": 219 },
          { "file": "install.ps1", "lineStart": 124, "lineEnd": 126 },
          { "file": "packages/cli/src/commands/install.ts", "line": 93 }
        ]
      },
      {
        "id": "rec-08-06",
        "description": "Update docs and CLI wrapper tests to assert --port parsing, help text, and passthrough behavior.",
        "status": "pending",
        "references": [
          { "file": "docs/cli.md", "lineStart": 20, "lineEnd": 47 },
          { "file": "packages/cli/test/install-methods.test.ts", "line": 103 },
          { "file": "packages/cli/test/main.test.ts", "line": 100 }
        ]
      }
    ]
  },
  {
    "id": "rec-09",
    "title": "Tighten docs expectation correctness",
    "description": "Update user docs to match bootstrap-first setup flow and temporary admin token terminology.",
    "status": "pending",
    "references": [
      { "file": "README.md", "line": 49 },
      { "file": "docs/cli.md", "line": 61 },
      { "file": "core/admin/docs/admin-guide.md", "line": 26 },
      { "file": "core/admin/README.md", "line": 23 }
    ],
    "subtasks": [
      {
        "id": "rec-09-01",
        "description": "Rewrite README install flow copy to describe bootstrap services first and full runtime at wizard completion.",
        "status": "pending",
        "references": [
          { "file": "README.md", "lineStart": 46, "lineEnd": 51 },
          { "file": "README.md", "line": 50 }
        ]
      },
      {
        "id": "rec-09-02",
        "description": "Replace admin password wording with temporary admin token wording in README and CLI docs.",
        "status": "pending",
        "references": [
          { "file": "README.md", "line": 49 },
          { "file": "docs/cli.md", "line": 61 },
          { "file": "docs/cli.md", "line": 95 }
        ]
      },
      {
        "id": "rec-09-03",
        "description": "Update admin guide and admin README credential terminology to align with x-admin-token usage.",
        "status": "pending",
        "references": [
          { "file": "core/admin/docs/admin-guide.md", "line": 57 },
          { "file": "core/admin/docs/admin-guide.md", "line": 58 },
          { "file": "core/admin/README.md", "line": 90 }
        ]
      },
      {
        "id": "rec-09-04",
        "description": "Remove or reframe stale setup.start_core narrative in docs/cli flow tables and sequence text.",
        "status": "pending",
        "references": [
          { "file": "docs/cli.md", "line": 151 },
          { "file": "docs/cli.md", "lineStart": 149, "lineEnd": 156 }
        ]
      },
      {
        "id": "rec-09-05",
        "description": "Run wording consistency scans for bootstrap services and temporary admin token terminology.",
        "status": "pending",
        "references": [
          { "file": "README.md", "line": 75 },
          { "file": "docs/cli.md", "line": 67 },
          { "file": "core/admin/docs/admin-guide.md", "line": 32 }
        ]
      }
    ]
  },
  {
    "id": "rec-10",
    "title": "Add self-healing retry affordances",
    "description": "Provide explicit user-driven retry for core startup failures with diagnostics and idempotent behavior.",
    "status": "pending",
    "references": [
      { "file": "packages/ui/src/routes/command/+server.ts", "line": 348 },
      { "file": "packages/ui/src/lib/components/CompleteStep.svelte", "line": 65 },
      { "file": "packages/lib/src/shared/logger.ts", "line": 50 }
    ],
    "subtasks": [
      {
        "id": "rec-10-01",
        "description": "Extend setup.complete failure contract to return setup_not_ready diagnostics and retryable metadata.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/routes/command/+server.ts", "line": 348 },
          { "file": "dev/docs/api-reference.md", "line": 33 }
        ]
      },
      {
        "id": "rec-10-02",
        "description": "Add setup.retry_core command that reuses the same shared readiness reconciliation function.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/routes/command/+server.ts", "line": 108 },
          { "file": "packages/lib/src/admin/compose-runner.ts", "line": 4 }
        ]
      },
      {
        "id": "rec-10-03",
        "description": "Ensure retry is user-initiated only and remove any silent auto-retry logic from setup UI.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/lib/components/SetupWizard.svelte", "line": 184 },
          { "file": "packages/ui/src/lib/components/CompleteStep.svelte", "line": 16 }
        ]
      },
      {
        "id": "rec-10-04",
        "description": "Add failed-state UI diagnostics panel with service statuses, compose stderr, log tails, and copy action.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/lib/components/CompleteStep.svelte", "line": 65 },
          { "file": "packages/ui/src/lib/components/SetupWizard.svelte", "line": 184 }
        ]
      },
      {
        "id": "rec-10-05",
        "description": "Emit structured server telemetry for failure, retry request/result, and diagnostics copy events.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/lib/server/init.ts", "line": 18 },
          { "file": "packages/lib/src/shared/logger.ts", "line": 50 }
        ]
      },
      {
        "id": "rec-10-06",
        "description": "Add API, component, and E2E tests covering failed completion, retry success, and idempotent repeated retries.",
        "status": "pending",
        "references": [
          { "file": "packages/ui/src/routes/command/command-setup-flow.test.ts", "line": 1 },
          { "file": "packages/ui/test/api/08-command-api.test.ts", "line": 40 },
          { "file": "test/install-e2e/happy-path.docker.ts", "line": 379 }
        ]
      }
    ]
  },
  {
    "id": "rec-11",
    "title": "Add release gate core health check",
    "description": "Add release-blocking full-stack setup E2E gate that verifies core service running and health convergence after setup completion.",
    "status": "pending",
    "references": [
      { "file": ".github/workflows/release.yml", "line": 161 },
      { "file": "test/install-e2e/happy-path.docker.ts", "line": 177 },
      { "file": "bunfig.toml", "line": 7 },
      { "file": "packages/lib/src/admin/compose-runner.ts", "line": 4 }
    ],
    "subtasks": [
      {
        "id": "rec-11-01",
        "description": "Create full-stack core-health install E2E test without busybox stubs.",
        "status": "pending",
        "references": [
          { "file": "test/install-e2e/core-health.docker.ts", "line": 1 },
          { "file": "test/install-e2e/happy-path.docker.ts", "line": 105 }
        ]
      },
      {
        "id": "rec-11-02",
        "description": "Add shared helper to parse compose ps output and compute missing or unhealthy core services.",
        "status": "pending",
        "references": [
          { "file": "test/install-e2e/helpers/core-health.ts", "line": 1 },
          { "file": "packages/lib/src/admin/compose-runner.ts", "line": 4 }
        ]
      },
      {
        "id": "rec-11-03",
        "description": "Assert post-setup compose running state, healthchecks, and HTTP probes for admin/gateway/assistant/openmemory.",
        "status": "pending",
        "references": [
          { "file": "test/install-e2e/core-health.docker.ts", "line": 1 },
          { "file": "dev/docs/install-setup-simplification-reliability-report-consolidated.md", "line": 222 }
        ]
      },
      {
        "id": "rec-11-04",
        "description": "Add package script test:install:core-health for local and CI parity.",
        "status": "pending",
        "references": [
          { "file": "package.json", "line": 20 }
        ]
      },
      {
        "id": "rec-11-05",
        "description": "Add setup-core-health-e2e workflow job with artifact upload and release-blocking needs linkage.",
        "status": "pending",
        "references": [
          { "file": ".github/workflows/release.yml", "line": 161 },
          { "file": ".github/workflows/release.yml", "line": 186 }
        ]
      },
      {
        "id": "rec-11-06",
        "description": "Document fallback triage policy for transient runner failures without bypassing release gate.",
        "status": "pending",
        "references": [
          { "file": "dev/docs/install-setup-simplification-reliability-report-consolidated.md", "line": 364 },
          { "file": ".github/workflows/release.yml", "line": 173 }
        ]
      }
    ]
  },
  {
    "id": "rec-12",
    "title": "Add install idempotency metadata",
    "description": "Replace install compose-content heuristics with persisted metadata and migration-safe lifecycle updates.",
    "status": "pending",
    "references": [
      { "file": "packages/cli/src/commands/install.ts", "lineStart": 125, "lineEnd": 142 },
      { "file": "packages/lib/src/paths.ts", "line": 24 },
      { "file": "packages/ui/src/routes/command/+server.ts", "line": 362 },
      { "file": "packages/cli/src/commands/uninstall.ts", "line": 110 }
    ],
    "subtasks": [
      {
        "id": "rec-12-01",
        "description": "Define install metadata schema and typed contracts including mode, version, runtime, port, and history.",
        "status": "pending",
        "references": [
          { "file": "packages/lib/src/types.ts", "line": 51 }
        ]
      },
      {
        "id": "rec-12-02",
        "description": "Implement metadata IO helper with atomic writes, validation, and legacy migration support.",
        "status": "pending",
        "references": [
          { "file": "packages/lib/src/install-metadata.ts", "line": 1 },
          { "file": "packages/lib/src/config.ts", "line": 12 }
        ]
      },
      {
        "id": "rec-12-03",
        "description": "Refactor install idempotency prompt logic to use metadata-first decisions with heuristic fallback.",
        "status": "pending",
        "references": [
          { "file": "packages/cli/src/commands/install.ts", "line": 125 },
          { "file": "packages/cli/src/commands/install.ts", "line": 132 }
        ]
      },
      {
        "id": "rec-12-04",
        "description": "Write and update metadata on successful install bootstrap, setup completion, and update command success.",
        "status": "pending",
        "references": [
          { "file": "packages/cli/src/commands/install.ts", "line": 305 },
          { "file": "packages/ui/src/routes/command/+server.ts", "line": 348 },
          { "file": "packages/cli/src/commands/update.ts", "line": 5 }
        ]
      },
      {
        "id": "rec-12-05",
        "description": "Preserve remove-all uninstall cleanup behavior and document metadata removal with state directory deletion.",
        "status": "pending",
        "references": [
          { "file": "packages/cli/src/commands/uninstall.ts", "line": 96 },
          { "file": "packages/cli/src/commands/uninstall.ts", "line": 110 }
        ]
      },
      {
        "id": "rec-12-06",
        "description": "Add tests and CI scripts for fresh, migrated, corrupt metadata, and uninstall cleanup scenarios.",
        "status": "pending",
        "references": [
          { "file": "packages/lib/src/install-metadata.test.ts", "line": 1 },
          { "file": "packages/cli/test/install.test.ts", "line": 7 },
          { "file": "package.json", "line": 20 },
          { "file": ".github/workflows/release.yml", "line": 161 }
        ]
      }
    ]
  }
]
